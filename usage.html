<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/usage.md at 2021-03-16
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>SSLContext Kickstart &#x2013; Usage</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/Hakky54/sslcontext-kickstart">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>sslcontext-kickstart</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-03-16<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 6.4.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="history.html" title="History"><span class="none"></span>History</a></li>
    <li class="active"><a href="#"><span class="none"></span>Usage</a></li>
   <li class="nav-header">Client configuration</li>
    <li><a href="client/akka.html" title="Akka Http"><span class="none"></span>Akka Http</a></li>
    <li><a href="client/apache4.html" title="Apache HttpClient 4"><span class="none"></span>Apache HttpClient 4</a></li>
    <li><a href="client/apache4-async.html" title="Apache Async HttpClient 4"><span class="none"></span>Apache Async HttpClient 4</a></li>
    <li><a href="client/apache5.html" title="Apache HttpClient 5"><span class="none"></span>Apache HttpClient 5</a></li>
    <li><a href="client/apache5-async.html" title="Apache Async HttpClient 5"><span class="none"></span>Apache Async HttpClient 5</a></li>
    <li><a href="client/apache-cxf-jax-rs.html" title="Apache CXF Jax RS"><span class="none"></span>Apache CXF Jax RS</a></li>
    <li><a href="client/apache-cxf-with-conduit-configurer.html" title="Apache CXF with Conduit"><span class="none"></span>Apache CXF with Conduit</a></li>
    <li><a href="client/async-http-client.html" title="Async Http Client"><span class="none"></span>Async Http Client</a></li>
    <li><a href="client/dispatch-reboot.html" title="Dispatch Reboot"><span class="none"></span>Dispatch Reboot</a></li>
    <li><a href="client/feign.html" title="Feign"><span class="none"></span>Feign</a></li>
    <li><a href="client/fuel.html" title="Fuel"><span class="none"></span>Fuel</a></li>
    <li><a href="client/grpc.html" title="gRPC"><span class="none"></span>gRPC</a></li>
    <li><a href="client/google.html" title="Google HttpClient"><span class="none"></span>Google HttpClient</a></li>
    <li><a href="client/http4k-apache4.html" title="Http4k with Apache HttpClient 4"><span class="none"></span>Http4k with Apache HttpClient 4</a></li>
    <li><a href="client/http4k-apache4-async.html" title="Http4k with Apache Async HttpClient 4"><span class="none"></span>Http4k with Apache Async HttpClient 4</a></li>
    <li><a href="client/http4k-apache5.html" title="Http4k with Apache HttpClient 5"><span class="none"></span>Http4k with Apache HttpClient 5</a></li>
    <li><a href="client/http4k-apache5-async.html" title="Http4k with Apache Async HttpClient 5"><span class="none"></span>Http4k with Apache Async HttpClient 5</a></li>
    <li><a href="client/http4k-java-http.html" title="Http4k with Java Http"><span class="none"></span>Http4k with Java Http</a></li>
    <li><a href="client/http4k-jetty.html" title="Http4k with Jetty"><span class="none"></span>Http4k with Jetty</a></li>
    <li><a href="client/http4k-okhttp.html" title="Http4k with OkHttp"><span class="none"></span>Http4k with OkHttp</a></li>
    <li><a href="client/http4s-blaze.html" title="Http4s Blaze Client"><span class="none"></span>Http4s Blaze Client</a></li>
    <li><a href="client/http4s-java-net.html" title="Http4s Java Net Client"><span class="none"></span>Http4s Java Net Client</a></li>
    <li><a href="client/jdk.html" title="JDK HttpClient"><span class="none"></span>JDK HttpClient</a></li>
    <li><a href="client/jersey.html" title="Jersey Client"><span class="none"></span>Jersey Client</a></li>
    <li><a href="client/jetty.html" title="Jetty Reactive HttpClient"><span class="none"></span>Jetty Reactive HttpClient</a></li>
    <li><a href="client/kohttp.html" title="Kohttp"><span class="none"></span>Kohttp</a></li>
    <li><a href="client/ktor-android.html" title="Ktor Android"><span class="none"></span>Ktor Android</a></li>
    <li><a href="client/ktor-apache.html" title="Ktor Apache"><span class="none"></span>Ktor Apache</a></li>
    <li><a href="client/ktor-okhttp.html" title="Ktor Okhttp"><span class="none"></span>Ktor Okhttp</a></li>
    <li><a href="client/methanol.html" title="Methanol"><span class="none"></span>Methanol</a></li>
    <li><a href="client/netty.html" title="Netty Reactor"><span class="none"></span>Netty Reactor</a></li>
    <li><a href="client/okhttp.html" title="OkHttp"><span class="none"></span>OkHttp</a></li>
    <li><a href="client/old-jdk.html" title="Old JDK HttpClient"><span class="none"></span>Old JDK HttpClient</a></li>
    <li><a href="client/old-jersey.html" title="Old Jersey Client"><span class="none"></span>Old Jersey Client</a></li>
    <li><a href="client/requests-scala.html" title="Requests-Scala"><span class="none"></span>Requests-Scala</a></li>
    <li><a href="client/retrofit.html" title="Retrofit"><span class="none"></span>Retrofit</a></li>
    <li><a href="client/scalaj.html" title="ScalaJ"><span class="none"></span>ScalaJ</a></li>
    <li><a href="client/spring-resttemplate.html" title="Spring RestTemplate"><span class="none"></span>Spring RestTemplate</a></li>
    <li><a href="client/spring-webclient-jetty.html" title="Spring WebFlux WebClient Jetty"><span class="none"></span>Spring WebFlux WebClient Jetty</a></li>
    <li><a href="client/spring-webclient-netty.html" title="Spring WebFlux WebClient Netty"><span class="none"></span>Spring WebFlux WebClient Netty</a></li>
    <li><a href="client/sttp.html" title="Sttp"><span class="none"></span>Sttp</a></li>
    <li><a href="client/finagle.html" title="Twitter Finagle"><span class="none"></span>Twitter Finagle</a></li>
    <li><a href="client/featherbed.html" title="Twitter Finagle Featherbed"><span class="none"></span>Twitter Finagle Featherbed</a></li>
    <li><a href="client/unirest.html" title="Unirest"><span class="none"></span>Unirest</a></li>
    <li><a href="client/vertx.html" title="Vertx"><span class="none"></span>Vertx</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="Usage"></a>Usage</h2><section>
<h3><a name="SSLFactory_configurations"></a>SSLFactory configurations</h3>
<p>SSLFactory can be enriched with additional configuration with the fluent api. It has already built-in default values for SecureRandom, HostnameVerifier, Encryption protocol, but can be overridden if required, see below for examples and additional configurations.</p><section><section>
<h5><a name="Loading_keystore_and_truststore_from_the_classpath"></a>Loading keystore and truststore from the classpath</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withIdentityMaterial(&quot;identity.jks&quot;, &quot;password&quot;.toCharArray())
          .withTrustMaterial(&quot;truststore.jks&quot;, &quot;password&quot;.toCharArray())
          .build();
</pre></div></div>
</section><section>
<h5><a name="Loading_keystore_and_trust_store_from_anywhere_on_the_filesystem"></a>Loading keystore and trust store from anywhere on the filesystem</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withIdentityMaterial(Paths.get(&quot;/path/to/your/identity.jks&quot;), &quot;password&quot;.toCharArray())
          .withTrustMaterial(Paths.get(&quot;/path/to/your/truststore.jks&quot;), &quot;password&quot;.toCharArray())
          .build();
</pre></div></div>
</section><section>
<h5><a name="Loading_keystore_and_trust_store_from_InputStream"></a>Loading keystore and trust store from InputStream</h5>

<div class="source">
<div class="source"><pre class="prettyprint">InputStream keyStoreStream = ...
InputStream trustStoreStream = ...

SSLFactory.builder()
          .withIdentityMaterial(keyStoreStream, &quot;password&quot;.toCharArray())
          .withTrustMaterial(trustStoreStream, &quot;password&quot;.toCharArray())
          .build();
</pre></div></div>
</section><section>
<h5><a name="Trusting_all_certificates_without_validation.2C_not_recommended_to_use_at_production.21"></a>Trusting all certificates without validation, not recommended to use at production!</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withTrustingAllCertificatesWithoutValidation()
          .build();
</pre></div></div>
</section><section>
<h5><a name="Loading_JDK_and_OS_trusted_certificates"></a>Loading JDK and OS trusted certificates</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withDefaultTrustMaterial()
          .withSystemTrustMaterial()
          .build();
</pre></div></div>
</section><section>
<h5><a name="Using_specific_protocols.2C_ciphers_with_custom_secure_random_and_hostname_verifier"></a>Using specific protocols, ciphers with custom secure random and hostname verifier</h5>
<p>If you are using java 11 or newer, than you are also able to use TLSv1.3 as encryption protocol by default.</p>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withDefaultTrustMaterial()
          .withProtocols(&quot;TLSv1.3&quot;, &quot;TLSv1.2&quot;)
          .withCiphers(&quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&quot;, &quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&quot;)
          .withHostnameVerifier(hostnameVerifier)
          .withSecureRandom(secureRandom)
          .build();
</pre></div></div>
</section><section>
<h5><a name="Support_for_using_multiple_identity_materials_and_trust_materials"></a>Support for using multiple identity materials and trust materials</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withIdentityMaterial(&quot;identity-1.jks&quot;, password)
          .withIdentityMaterial(&quot;identity-2.jks&quot;, password)
          .withIdentityMaterial(&quot;identity-3.jks&quot;, password)
          .withIdentityMaterial(&quot;identity-4.jks&quot;, password)
          .withTrustMaterial(&quot;truststore-1.jks&quot;, password)
          .withTrustMaterial(&quot;truststore-2.jks&quot;, password)
          .withTrustMaterial(&quot;truststore-3.jks&quot;, password)
          .withTrustMaterial(&quot;truststore-4.jks&quot;, password)
          .build();
</pre></div></div>
</section><section>
<h5><a name="Support_for_using_X509ExtendedKeyManager_and_X509ExtendedTrustManager"></a>Support for using X509ExtendedKeyManager and X509ExtendedTrustManager</h5>

<div class="source">
<div class="source"><pre class="prettyprint">X509ExtendedKeyManager keyManager = ...
X509ExtendedTrustManager trustManager = ...

SSLFactory.builder()
          .withIdentityMaterial(keyManager)
          .withTrustMaterial(trustManager)
          .build();
</pre></div></div>
</section><section>
<h5><a name="Support_for_swapping_KeyManager_and_TrustManager_at_runtime"></a>Support for swapping KeyManager and TrustManager at runtime</h5>
<p>It is possible to swap a KeyManager and TrustManager from a SSLContext, SSLSocketFactory and SSLServerSocketFactory while already using it within your client or server at runtime. This option will enable to refresh the identity and trust material of a server or client without the need of restarting your application or recreating it with SSLFactory. The identity and trust material may expire at some point in time and needs to be replaced to be still functional. Restart of the application with a traditional setup is unavoidable and can result into a downtime for x amount of time. A restart is not needed when using the setup below.</p>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory sslFactory = SSLFactory.builder()
          .withSwappableIdentityMaterial()
          .withIdentityMaterial(&quot;identity.jks&quot;, &quot;password&quot;.toCharArray())
          .withSwappableTrustMaterial()
          .withTrustMaterial(&quot;truststore.jks&quot;, &quot;password&quot;.toCharArray())
          .build();
          
HttpClient httpClient = HttpClient.newBuilder()
          .sslParameters(sslFactory.getSslParameters())
          .sslContext(sslFactory.getSslContext())
          .build()

// execute https request
HttpResponse&lt;String&gt; response = httpClient.send(aRequest, HttpResponse.BodyHandlers.ofString());

// swap identity and trust materials and reuse existing http client
KeyManagerUtils.swapKeyManager(sslFactory.getKeyManager().get(), anotherKeyManager);
TrustManagerUtils.swapTrustManager(sslFactory.getTrustManager().get(), anotherTrustManager);
HttpResponse&lt;String&gt; response = httpClient.send(aRequest, HttpResponse.BodyHandlers.ofString());
</pre></div></div>

<p>See here for a basic reference implementation for a server: <a class="externalLink" href="https://github.com/Hakky54/instant-ssl-reloading">GitHub - Instant SSL Reloading</a></p></section><section>
<h5><a name="Support_for_using_a_single_KeyStore_which_contains_multiple_keys_with_different_passwords"></a>Support for using a single KeyStore which contains multiple keys with different passwords</h5>

<div class="source">
<div class="source"><pre class="prettyprint">KeyStore keyStore = ...
X509ExtendedKeyManager keyManager = KeyManagerUtils.createKeyManager(keyStore, Map.of(
        &quot;foo&quot;,&quot;foo-password&quot;.toCharArray(),
        &quot;bar&quot;,&quot;bar-password&quot;.toCharArray(),
        &quot;lorum-ipsum&quot;,&quot;lorum-ipsum-password&quot;.toCharArray()
));

SSLFactory.builder()
          .withIdentityMaterial(keyManager)
          .withDefaultTrustMaterial()
          .build();
</pre></div></div>
</section><section>
<h5><a name="Routing_identity_material_to_specific_host"></a>Routing identity material to specific host</h5>
<p>It may occur that the client is sending the wrong certificate to the server when using multiple identities. This will happen when the client certificate has insufficient information for the underlying ssl engine (the KeyManager) and therefore it cannot select the right certificate. Recreating the certificates can resolve this issue. However, if that is not possible you can provide an option to the engine to use a specific certificate for a given server. Below is an example setup for correctly routing the client identity based on the alias which can be found within the KeyStore file.</p>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory.builder()
          .withIdentityMaterial(&quot;identity-1.jks&quot;, password)
          .withIdentityMaterial(&quot;identity-2.jks&quot;, password)
          .withTrustMaterial(&quot;truststore.jks&quot;, password)
          .withClientIdentityRoute(&quot;client-alias-one&quot;, &quot;https://localhost:8443/&quot;, &quot;https://localhost:8453/&quot;)
          .withClientIdentityRoute(&quot;client-alias-two&quot;, &quot;https://localhost:8463/&quot;, &quot;https://localhost:8473/&quot;)
          .build();
</pre></div></div>
</section><section>
<h5><a name="Updating_client_identity_routes_at_runtime"></a>Updating client identity routes at runtime</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory sslFactory = SSLFactory.builder()
          .withIdentityMaterial(&quot;identity-1.jks&quot;, password)
          .withIdentityMaterial(&quot;identity-2.jks&quot;, password)
          .withTrustMaterial(&quot;truststore.jks&quot;, password)
          .withClientIdentityRoute(&quot;client-alias-one&quot;, &quot;https://localhost:8443/&quot;, &quot;https://localhost:8453/&quot;)
          .withClientIdentityRoute(&quot;client-alias-two&quot;, &quot;https://localhost:8463/&quot;, &quot;https://localhost:8473/&quot;)
          .build();

X509ExtendedKeyManager keyManager = sslFactory.getKeyManager().get()

// Add additional routes next to the existing ones
KeyManagerUtils.addClientIdentityRoute(keyManager, &quot;client-alias-one&quot;, &quot;https://localhost:8463/&quot;, &quot;https://localhost:8473/&quot;)

// Override existing routes
KeyManagerUtils.overrideClientIdentityRoute(keyManager, &quot;client-alias-two&quot;, &quot;https://localhost:9463/&quot;, &quot;https://localhost:9473/&quot;)
</pre></div></div>
</section><section>
<h5><a name="Managing_ssl_session"></a>Managing ssl session</h5>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory sslFactory = SSLFactory.builder()
          .withIdentityMaterial(&quot;identity.jks&quot;, &quot;password&quot;.toCharArray())
          .withTrustMaterial(&quot;truststore.jks&quot;, &quot;password&quot;.toCharArray())
          .withSessionTimeout(3600) // Amount of seconds untill it will be invalidated
          .withSessionCacheSize(1024) // Amount of bytes untill it will be invalidated
          .build();
          
// Caches can be invalidated with the snippet below
SSLSessionUtils.invalidateCaches(sslFactory.getSslContext());

// or any other option:
SSLSessionUtils.invalidateCachesBefore(sslFactory.getSslContext(), ZonedDateTime.of(LocalDateTime.of(2021, Month.JANUARY, 1, 15, 55), ZoneOffset.UTC));

SSLSessionUtils.invalidateCachesAfter(sslFactory.getSslContext(), ZonedDateTime.of(LocalDateTime.of(2021, Month.FEBRUARY, 10, 8, 14), ZoneOffset.UTC));

SSLSessionUtils.invalidateCachesBetween(
        sslFactory.getSslContext(),
        ZonedDateTime.now().minusHours(2),    // from
        ZonedDateTime.now()                   // up till
);
</pre></div></div>
</section><section>
<h5><a name="Support_for_using_PrivateKey_and_Certificates"></a>Support for using PrivateKey and Certificates</h5>

<div class="source">
<div class="source"><pre class="prettyprint">PrivateKey privateKey = ...
char[] privateKeyPassword = ...
Certificate[] certificateChain = ...

Certificate trustedCertificate = ...

SSLFactory.builder()
          .withIdentityMaterial(privateKey, privateKeyPassword, certificateChain)
          .withTrustMaterial(trustedCertificate)
          .build();
</pre></div></div>
</section></section><section>
<h4><a name="Using_PEM_Files"></a>Using PEM Files</h4>
<p>Support for using pem formatted private key and certificates from classpath, any directory or as an InputStream. See <a href="sslcontext-kickstart-for-pem/src/test/java/nl/altindag/ssl/util/PemUtilsShould.java">PemUtilsShould</a> for detailed usages. Add the dependency below to use this feature, it also includes the core features from the library such as SSLFactory.</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;io.github.hakky54&lt;/groupId&gt;
    &lt;artifactId&gt;sslcontext-kickstart-for-pem&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre></div></div>
<section>
<h5><a name="Loading_pem_files_from_the_classpath"></a>Loading pem files from the classpath</h5>

<div class="source">
<div class="source"><pre class="prettyprint">X509ExtendedKeyManager keyManager = PemUtils.loadIdentityMaterial(&quot;certificate.pem&quot;, &quot;private-key.pem&quot;);
X509ExtendedTrustManager trustManager = PemUtils.loadTrustMaterial(&quot;some-trusted-certificate.pem&quot;);

SSLFactory.builder()
          .withIdentityMaterial(keyManager)
          .withTrustMaterial(trustManager)
          .build();
</pre></div></div>
</section><section>
<h5><a name="Loading_pem_files_from_anywhere_on_the_filesystem"></a>Loading pem files from anywhere on the filesystem</h5>

<div class="source">
<div class="source"><pre class="prettyprint">X509ExtendedKeyManager keyManager = PemUtils.loadIdentityMaterial(Paths.get(&quot;/path/to/your/certificate.pem&quot;), Paths.get(&quot;/path/to/your/&quot;private-key.pem&quot;));
X509ExtendedTrustManager trustManager = PemUtils.loadTrustMaterial(Paths.get(&quot;/path/to/your/&quot;some-trusted-certificate.pem&quot;));
</pre></div></div>
</section><section>
<h5><a name="Loading_pem_files_from_InputStream"></a>Loading pem files from InputStream</h5>

<div class="source">
<div class="source"><pre class="prettyprint">InputStream privateKey = ...
InputStream certificate = ...
InputStream trustedCertificates = ...

X509ExtendedKeyManager keyManager = PemUtils.loadIdentityMaterial(certificate, privateKey);
X509ExtendedTrustManager trustManager = PemUtils.loadTrustMaterial(trustedCertificates);
</pre></div></div>
</section><section>
<h5><a name="Loading_pem_files_from_string_content"></a>Loading pem files from string content</h5>

<div class="source">
<div class="source"><pre class="prettyprint">String privateKey =
        &quot;-----BEGIN ENCRYPTED PRIVATE KEY-----\n&quot; +
        &quot;MIIFHDBOBgkqhkiG9w0BBQ0wQTApBgkqhkiG9w0BBQwwHAQIy3Fposf+2ccCAggA\n&quot; +
        &quot;-----END ENCRYPTED PRIVATE KEY-----\n&quot;;

String certificate =
        &quot;-----BEGIN CERTIFICATE-----\n&quot; +
        &quot;g0Y2YBH5v0xmi8sYU7weOcwynkjZARpUltBUQ0pWCF5uJsEB8uE8PPDD3c4=\n&quot; +
        &quot;-----END CERTIFICATE-----\n&quot;;

String trustedCertificates =
        &quot;-----BEGIN CERTIFICATE-----\n&quot; +
        &quot;CC01zojqS10nGowxzOiqyB4m6wytmzf0QwjpMw==\n&quot; +
        &quot;-----END CERTIFICATE-----\n&quot;;

X509ExtendedKeyManager keyManager = PemUtils.parseIdentityMaterial(certificate, privateKey, &quot;secret&quot;.toCharArray());
X509ExtendedTrustManager trustManager = PemUtils.parseTrustMaterial(trustedCertificates);
</pre></div></div>
</section><section>
<h5><a name="Loading_encrypted_pem_files"></a>Loading encrypted pem files</h5>

<div class="source">
<div class="source"><pre class="prettyprint">X509ExtendedKeyManager keyManager = PemUtils.loadIdentityMaterial(&quot;certificate.pem&quot;, &quot;private-key.pem&quot;, &quot;secret&quot;.toCharArray());
</pre></div></div>
</section><section>
<h5><a name="Migrating_from_classic_configuration"></a>Migrating from classic configuration</h5>
<p>Below is an example of the classic configuration for enabling ssl for your application.</p>

<div class="source">
<div class="source"><pre class="prettyprint">-Djavax.net.ssl.trustStore=/path/to/truststore.jks
-Djavax.net.ssl.trustStoreType=jks
-Djavax.net.ssl.trustStorePassword=changeit
-Djavax.net.ssl.keyStore=/path/to/keystore.jks
-Djavax.net.ssl.keyStoreType=jks
-Djavax.net.ssl.keyStorePassword=changeit
-Djdk.tls.client.protocols=TLSv1.3
-Dhttps.protocols=TLSv1.3
</pre></div></div>

<p>This can be refactored to the configuration below:</p>

<div class="source">
<div class="source"><pre class="prettyprint">SSLFactory sslFactory = SSLFactory.builder()
        .withIdentityMaterial(Paths.get(&quot;/path/to/keystore.jks&quot;), &quot;changeit&quot;.toCharArray(), &quot;jks&quot;)
        .withTrustMaterial(Paths.get(&quot;/path/to/truststore.jks&quot;), &quot;changeit&quot;.toCharArray(), &quot;jks&quot;)
        .withProtocols(&quot;TLSv1.3&quot;)
        .build();
</pre></div></div>
</section></section></section><section>
<h3><a name="Additional_mappers_for_specific_libraries"></a>Additional mappers for specific libraries</h3>
<p>Some http clients relay on different ssl classes from third parties and require mapping from SSLFactory to those libraries. Below you will find the maven dependency which will provide the mapping and also the SSLFactory library. When using one of the below libraries, it is not required to also explicitly include sslcontext-kickstart.</p><section>
<h4><a name="Netty"></a>Netty</h4>
<p>Some know http clients which relay on netty libraries are: <a class="externalLink" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux WebClient Netty</a>, <a class="externalLink" href="https://github.com/AsyncHttpClient/async-http-client">Async Http Client</a> and <a class="externalLink" href="https://github.com/dispatch/reboot">Dispatch Reboot Http Client</a>.</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;io.github.hakky54&lt;/groupId&gt;
    &lt;artifactId&gt;sslcontext-kickstart-for-netty&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre></div></div>

<p>Example setup for Spring WebClient with Netty:</p>

<div class="source">
<div class="source"><pre class="prettyprint">import io.netty.handler.ssl.SslContext;
import nl.altindag.ssl.SSLFactory;
import nl.altindag.ssl.util.NettySslUtils;
import org.springframework.http.client.reactive.ReactorClientHttpConnector;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.netty.http.client.HttpClient;

import javax.net.ssl.SSLException;

public class App {
    
    public static void main(String[] args) throws SSLException {
        SSLFactory sslFactory = SSLFactory.builder()
                .withDefaultTrustMaterial()
                .build();

        SslContext sslContext = NettySslUtils.forClient(sslFactory).build();
        HttpClient httpClient = HttpClient.create()
                .secure(sslSpec -&gt; sslSpec.sslContext(sslContext));

        WebClient webClient = WebClient.builder()
                .clientConnector(new ReactorClientHttpConnector(httpClient))
                .build();
    }

}
</pre></div></div>
</section><section>
<h4><a name="Jetty"></a>Jetty</h4>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;io.github.hakky54&lt;/groupId&gt;
    &lt;artifactId&gt;sslcontext-kickstart-for-jetty&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre></div></div>

<p>Example setup for <a class="externalLink" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux WebClient Jetty</a>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">import nl.altindag.ssl.SSLFactory;
import nl.altindag.ssl.util.JettySslUtils;
import org.eclipse.jetty.client.HttpClient;
import org.eclipse.jetty.util.ssl.SslContextFactory;
import org.springframework.http.client.reactive.JettyClientHttpConnector;
import org.springframework.web.reactive.function.client.WebClient;

public class App {

    public static void main(String[] args) {
        SSLFactory sslFactory = SSLFactory.builder()
                .withDefaultTrustMaterial()
                .build();
        
        SslContextFactory.Client sslContextFactory = JettySslUtils.forClient(sslFactory);
        HttpClient httpClient = new HttpClient(sslContextFactory);

        WebClient webClient = WebClient.builder()
                .clientConnector(new JettyClientHttpConnector(httpClient))
                .build();
    }

}
</pre></div></div>
</section><section>
<h4><a name="Apache"></a>Apache</h4>
<p>Apache Http Client works with javax.net.ssl.SSLContext, so an additional mapping to their library is not required, <a href="./index.html">see here</a>. However it is still possible to configure the http client with their custom configuration class. you can find below an example configuration for that use case:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;io.github.hakky54&lt;/groupId&gt;
    &lt;artifactId&gt;sslcontext-kickstart-for-apache4&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre></div></div>

<div class="source">
<div class="source"><pre class="prettyprint">import nl.altindag.ssl.SSLFactory;
import nl.altindag.ssl.util.Apache4SslUtils;
import org.apache.http.client.HttpClient;
import org.apache.http.conn.socket.LayeredConnectionSocketFactory;
import org.apache.http.impl.client.HttpClients;

public class App {

    public static void main(String[] args) {
        SSLFactory sslFactory = SSLFactory.builder()
                .withDefaultTrustMaterial()
                .build();

        LayeredConnectionSocketFactory socketFactory = Apache4SslUtils.toSocketFactory(sslFactory);

        HttpClient httpClient = HttpClients.custom()
                .setSSLSocketFactory(socketFactory)
                .build();
    }

}
</pre></div></div></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2021..</p>
        </div>
      </div>
    </footer>
  </body>
</html>
